/**
 * This file is part of the simple-css-tokenizer package.
 *
 * (c) Vjacheslav Trushkin <cyberalien@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){var b={};!function(){var a=function(){function a(b,c,d){if(_classCallCheck(this,a),this.message=b,"number"==typeof d&&d!==-1){var e=d,f=c.slice(d)+"!",g=f.trim(),h=e+f.length-g.length,i=c.slice(0,h),j=i.length-i.replace(/\n/g,"").length+1;this.message+=" on line "+j}}return _createClass(a,[{key:"getMessage",value:function(){return this.message}}]),a}();b.Error=a}(),function(){var a=function(){function a(b){_classCallCheck(this,a),b=void 0===b?{}:b,this.minify=void 0!==b.minify&&b.minify,this.tab=this.minify?"":void 0===b.tab?"\t":b.tab,this.newline=this.minify?"":void 0===b.newline?"\n":b.newline,this.newLineAfterSelector=void 0===b.newLineAfterSelector||b.newLineAfterSelector,this.ruleSeparator=this.minify?":":": ",this.selectorsSeparator=this.minify?",":", ",this.ruleModifiers=void 0!==b.ruleModifiers?b.ruleModifiers:["default","important"]}return _createClass(a,[{key:"build",value:function(a){return this._build(a,"").trim()}},{key:"_build",value:function(a,b){var c=this,d="",e=!1,f=0;return a.forEach(function(a){switch(a.token){case"code":d+=b+a.code+c.newline;break;case"}":f--,b=b.slice(c.tab.length),d+=b+"}"+c.newline;break;case"{":if("}"===e&&(d+=c.newline),void 0!==a.selectors)d+=b+a.selectors.join(c.selectorsSeparator);else if(void 0!==a.atRule){if(d+=b+"@"+a.atRule,a.atValues&&a.atValues.length){var g=a.atValues.join(c.selectorsSeparator);d+=g.length?" "+g:""}}else d+=b+a.code;d+=(c.newLineAfterSelector?c.newline+b:c.minify?"":" ")+"{"+c.newline,a.children?(d+=c._build(a.children,b+c.tab),d+=b+"}"+c.newline):(f++,b+=c.tab);break;case"rule":d+=b+a.key+c.ruleSeparator+a.value,c.ruleModifiers.forEach(function(b){a[b]&&(d+=" !"+b)}),d+=";"+c.newline}e=a.token}),d}}]),a}();b.Builder=a}(),function(){var a=b.Error,c=b.Builder,d=function(){function b(a){_classCallCheck(this,b),a=void 0===a?{}:a,this.splitRules=a.splitRules!==!1,this.ignoreErrors=a.ignoreErrors!==!1,this.lessSyntax=a.lessSyntax===!0,this.ruleModifiers=void 0!==a.ruleModifiers?a.ruleModifiers:["default","important"]}return _createClass(b,null,[{key:"build",value:function(a,b){return new c(b).build(a)}}]),_createClass(b,[{key:"tree",value:function(b){this._tokens=this.tokenize(b);for(var c=this._parseTokens(this._tokens.shift());this._tokens.length;)this.ignoreErrors||this.errors.push(new a("Unmatched }",this._css,this._tokens[0].index)),c=c.concat(this._parseTokens(this._tokens.shift()));return c}},{key:"tokenize",value:function(b){var c=this;this._css=b,this._cssLC=b.toLowerCase(),this.errors=[];var d=0,e=[],f=[],g=0,h=0,i=0,j=0,k=0,l=!1,m=this._css.length,n=['"',"'","/*","{","}",";","url(","\\"];if(this.lessSyntax&&(n=n.concat(["(",")","//","@{","#{"])),this._findTokens(n).forEach(function(b){if(!(b.index<d)){var n=void 0;switch(b.token){case"//":e.push({type:"text",text:c._css.slice(d,b.index),index:d}),d=b.index;var o=c._css.indexOf("\n",d+2),p=c._css.indexOf("\r",d+2);if(n=o===-1?p:p===-1?o:Math.min(o,p),n===-1){d=m;break}d=n+1;break;case"/*":if(e.push({type:"text",text:c._css.slice(d,b.index),index:d}),d=b.index,n=c._css.indexOf("*/",d+2),n===-1){c.ignoreErrors||(c.errors.push(new a("Missing comment closing statement",c._css,d)),l=!0),d=m;break}d=n+2;break;case"\\":e.push({type:"text",text:c._css.slice(d,b.index+2),index:d}),d=b.index+2;break;case"url(":if(e.push({type:"text",text:c._css.slice(d,b.index),index:d}),d=b.index,n=c._findEndOfURL(d),"number"!=typeof n){e.push({type:"text",text:c._css.slice(d,d+3),index:d}),c.ignoreErrors||(c.errors.push(new a("Incomplete URL",c._css,d)),l=!0),d+=3;break}e.push({type:"url",text:c._css.slice(d,n),index:d}),d=n;break;case'"':case"'":if(e.push({type:"text",text:c._css.slice(d,b.index),index:d}),d=b.index,n=c._findEndOfQuotedString(b.token,d),n===!1){c.ignoreErrors?(e.push({type:"text",text:c._css.slice(d,d+1),index:d}),d++):(c.errors.push(new a("Missing closing "+b.token,c._css,d)),l=!0,e.push({type:"code",text:c._css.slice(d),index:d}),d=m);break}e.push({type:"string",text:c._css.slice(d,n),index:d}),d=n;break;case";":if(h>0)break;c.splitRules&&(e.push({type:"text",text:c._css.slice(d,b.index),index:d}),f.push(c._checkRule(e,b.token,l)),l&&(f[f.length-1].error=!0,l=!1)),k=d=b.index+1,e=[];break;case"{":if(!c.splitRules&&k>j){var q=c._css.slice(j,k).trim();q.length&&(f.push({token:"code",code:q,index:j}),l&&(f[f.length-1].error=!0,l=!1))}e.push({type:"text",text:c._css.slice(d,b.index),index:d}),f.push(c._checkSelectors(e)),l&&(f[f.length-1].error=!0,l=!1),j=k=d=b.index+1,e=[],g++;break;case"}":if(i>0){if(1===i&&c.splitRules){for(var r=!1,s=c._css.slice(d,b.index+1),t=e.length-1;t>=0;t--){if(e[t].beforeExpression){r=!0,delete e[t].beforeExpression,t===e.length-1?e.push({type:"expression",text:s,index:d}):(d=e[t+1].index,e=e.slice(0,t+1),e.push({type:"expression",text:s,index:d}));break}s=e[t].text+s}r||e.push({type:"expression",text:s,index:d,error:!0}),d=b.index+1}i--;break}if(c.splitRules)e.push({type:"text",text:c._css.slice(d,b.index),index:d}),f.push(c._checkRule(e,"",l)),l&&(f[f.length-1].error=!0);else{var u=c._css.slice(j,b.index).trim();u.length&&(f.push({token:"code",code:u,index:j}),l&&(f[f.length-1].error=!0))}l=!1,f.push({token:"}",index:b.index}),l=!1,g||c.ignoreErrors||c.errors.push(new a("Unexpected }",c._css,b.index)),g--,j=k=d=b.index+1,e=[],h=0;break;case"(":if(c.splitRules){var v={type:"text",text:c._css.slice(d,b.index),index:d};h||(v.beforeFunction=!0),e.push(v),d=b.index}h++;break;case")":if(1===h&&c.splitRules){for(var w=!1,x=c._css.slice(d,b.index+1),y=e.length-1;y>=0;y--){if(e[y].beforeFunction){w=!0,delete e[y].beforeFunction,y===e.length-1?e.push({type:"function",text:x,index:d}):(d=e[y+1].index,e=e.slice(0,y+1),e.push({type:"function",text:x,index:d}));break}x=e[y].text+x}w||e.push({type:"function",text:x,index:d,error:!0}),d=b.index+1}h--,h<0&&(h=0);break;case"@{":case"#{":if(c.splitRules){var z={type:"text",text:c._css.slice(d,b.index+2),index:d};i||(z.beforeExpression=!0),e.push(z),d=b.index+2}i++}}}),g>0&&!this.ignoreErrors&&this.errors.push(new a("Missing }",this._css,m)),this.splitRules)e.push({type:"text",text:this._css.slice(d),index:d}),f.push(this._checkRule(e,"",l)),l&&(f[f.length-1].error=!0);else{var o=this._css.slice(j).trim();o.length&&(f.push({token:"code",code:o,index:j}),l&&(f[f.length-1].error=!0))}return f.filter(function(a){return a!==!1})}},{key:"_findTokens",value:function(a){var b=this,c=[];return a.forEach(function(a){for(var d=0;;){if(d=b._cssLC.indexOf(a,d),d===-1)return;c.push({token:a,index:d}),d++}}),c.sort(function(a,b){return a.index-b.index}),c}},{key:"_findEndOfQuotedString",value:function(a,b){var c=this._css.indexOf("\\",b+1),d=this._css.indexOf(a,b+1);if(d===-1)return!1;for(;c!==-1&&c<d;){if(d===c+1&&(d=this._css.indexOf(a,d+1),d===-1))return!1;c=this._css.indexOf("\\",c+2)}return d+1}},{key:"_findEndOfURL",value:function(b){for(var c=(b||0)+4,d=this._css.length,e=void 0,f=void 0;c<d;)switch(e=this._css.charAt(c)){case'"':case"'":return f=this._findEndOfQuotedString(e,c),f===!1?new a("Incomplete string",this._css,c):(f=this._css.indexOf(")",f),f===-1?new a("Cannot find end of URL",this._css,b):f+1);case" ":case"\t":case"\r":case"\n":c++;break;default:for(;;){switch(e){case")":return c+1;case'"':case"'":case"(":case" ":case"\t":case"\r":case"\n":return new a("Invalid URL",this._css,b);default:if(this._css.charCodeAt(c)<32)return new a("Invalid URL",this._css,b)}if(c++,c>=d)return new a("Cannot find end of URL",this._css,b);e=this._css.charAt(c)}}return new a("Cannot find end of URL",this._css,b)}},{key:"_checkRule",value:function(b,c,d){var e=this._findRulePairs(b),f=void 0,g=void 0;return"boolean"==typeof e?(f=this._mergeWords(b)+c,!!f.length&&(g=b[0].index,e!==!1||this.ignoreErrors||d||this.errors.push(new a("Invalid css rule",this._css,g)),{token:"code",code:f,index:g})):e}},{key:"_mergeWords",value:function(a){return a.map(function(a){return a.text}).join("").trim()}},{key:"_checkSelectors",value:function(a){var b=this._getSelectors(a),c={token:"{",code:this._mergeWords(a),index:a[0].index};return b.length?("@"===b[0].charAt(0)?(c.atRule=b[0].split(/\s+/,1)[0].slice(1),b[0]=b[0].slice(1+c.atRule.length).trim(),c.atValues=b):c.selectors=b,c):c}},{key:"_getSelectors",value:function(a){var b=[],c="";return a.forEach(function(a){if("text"!==a.type)return void(c+=a.text);var d=a.text.split(",");for(c+=d.shift();d.length>0;)b.push(c.trim()),c=d.shift()}),b.push(c.trim()),b.filter(function(a){return a.length>0})}},{key:"_findRulePairs",value:function(a){var b=this,c="",d="",e=!0,f=!1,g=!1,h=void 0;return a.forEach(function(a){if(!f){if("text"!==a.type)return e?b.lessSyntax?("function"===a.type&&(g=!0),void(c+=a.text)):void(f=!0):void(d+=a.text);var h=a.text.split(":");return b.lessSyntax&&h.length>1&&(h.forEach(function(a,b){b>0&&("extend"===a||"extend("===a.slice(0,7))&&(h[b-1]+=":"+h[b],h[b]=null)}),h=h.filter(function(a){return null!==a})),h.length>2?void(f=!0):2===h.length?e?(c+=h[0],d=h[1],void(e=!1)):void(f=!0):void(e?c+=a.text:d+=a.text)}}),!f&&(e?!!this.lessSyntax&&(g||"@"===c.trim().slice(0,1)):(c=c.trim(),d=d.trim(),!(!c.length||!d.length)&&(h={token:"rule",key:c,value:d,index:a[0].index},this.ruleModifiers.forEach(function(a){h.value.slice(0-a.length-1).toLowerCase()==="!"+a&&(h[a]=!0,h.value=h.value.slice(0,h.value.length-a.length-1).trim())}),!!h.value.length&&h)))}},{key:"_parseTokens",value:function(a){for(var b=[];void 0!==a;){switch(a.token){case"}":return b;case"{":a.children=this._parseTokens(this._tokens.shift()),b.push(a);break;default:b.push(a)}a=this._tokens.shift()}return b}}]),b}();b.Tokenizer=d}(),a.CATokenizer=b.Tokenizer}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:"undefined"!=typeof global?global:Function("return this;")());
